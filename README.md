![Build Status](https://github.com/internetarchive/archiveorg-e2e-tests/actions/workflows/main.yml/badge.svg)

# End to end tests for Archive.org using [Playwright](https://playwright.dev/)


## (Optional) BrowserStack Local Setup

- Login to BrowserStack and retrieve the account username and access key, see documentation [here](https://www.browserstack.com/docs/automate/playwright/getting-started/nodejs/test-runner)


## Local Setup

- Install dependencies:

    `npm i`

- Install Playwright browser libs:

    `npx playwright install`

- Create a `.env` file by copying the contents from `.env.sample` and add the respective values you want to use for testing

    - this is required to run tests with loggedIn flows


## Running tests

- Run all tests: `npm run test`

- Run tests using `generate` command:

    - See `scripts/generateCommand.js`, update the arguments that starts at `line:36`

    - Run the command: `npm run generate:command`, run the generated by the command

- Run tests using custom execute script:

    > Note:
    >   - This will run a custom script that can take different shell script arguments/parameters for the following:
    >   - The arrangement/order for passing of arguments can be jumbled for flexibility
    >   - It's important to add `--` convention in CLI after the `npm command`
    >       - It will separate npm-specific arguments from the arguments that are intended for the nodejs script
    >       - Without `--`, it will not pass the arguments properly


    - __Test category (by folder structure)__:
        - It will run all tests if you didn't specify the test category you want to test
        - This argument is annotated as `--test`
        - This can only execute 1 category in 1 command
        - Refer to the folder names in `tests` directory (`tests/*`), except for `tests/page-objects`
        - Sample parameters: `about, av, books, collection, details, donation, home, login, music, profile, search`
        - Sample execution:

            `npm run execute -- --test=about`

            `npm run execute -- --test=books`

            `npm run execute -- --test=donation`

            `npm run execute -- --test=profile`

    - __Test execution mode__:
        - The tests will run in headless mode by __default__ which will execute the tests in terminal only
        - This argument is annotated as `--headed`
        - Headed mode will spawn a browser window in the screen and execute the tests
        - Sample execution:

            `npm run execute -- --test=about --headed`

            `npm run execute -- --headed --test=about`

    - __Test execution - [debug mode](https://playwright.dev/docs/running-tests#debug-tests-with-the-playwright-inspector)__:
        - This will spawn a browser window and Playwright Inspector window in the screen which will help on inspecting the whole test execution flow step by step
        - This argument is annotated as `--debug`
        - Sample execution:

            `npm run execute -- --test=about --debug`

            `npm run execute -- --debug --test=books`

    - __Test execution - [UI mode](https://playwright.dev/docs/running-tests#debug-tests-in-ui-mode)__:
        - This will spawn a browser window and Playwright Inspector window in the screen which will help on inspecting the whole test execution flow step by step
        - This argument is annotated as `--ui`
        - Sample execution:

            `npm run execute -- --test=about --ui`

    - __Test execution with [Trace viewer](https://playwright.dev/docs/trace-viewer) mode__:
        - Trace viewer will record the test run which will be included in the Playwright report
        - This argument is annotated as `--trace`
        - It is disabled by default, you can enable it with the command below
        - Accepted parameters: `trace`
        - Sample execution:

            `npm run execute -- --test=about --trace`

    - __Test execution by browser__:
        - Tests will run in all browsers by default if you didn't specify the browser
        - This argument is annotated as `--browser`
        - Accepted parameters: `chromium, firefox, webkit`
        - Sample execution:

            `npm run execute -- --test=about --browser=chromium`

            `npm run execute -- --test=about --browser=firefox --debug`

            `npm run execute -- --test=about --browser=webkit --headed`

    - __Test execution by test title__:
        - This command will grep for test title specified in `.spec.ts` test description
        - This argument is annotated as `--title`
        - The custom script will treat it as the `-g` parameter or run as a `grep` command like how Playwright does it
        - Tests will run in all browsers by default if you didn't specify the browser
        - This can be combined with other commands if needed
        - Sample execution:

            `npm run execute -- --title="TV has borrow button"`

            `npm run execute -- --title="Canonical About page has correct title and text" --browser=chromium`

            `npm run execute -- --title="Canonical About page has correct title and text" --debug`


## Running tests using VSCode Playwright plugin

- install [VSCode Playwright plugin](https://marketplace.visualstudio.com/items?itemName=ms-playwright.playwright) to run specific tests using VSCode


## Running specific test spec by file:

- run command format: `npx playwright test <test-file-path>`
- sample: `npx playwright test tests/search/search-layout.spec.ts`
- headed: `npx playwright test tests/search/search-layout.spec.ts --headed`


## Running specific test spec by file in debug mode:

- run command format: `npx playwright test <test-file-path> --debug`
- sample: `npx playwright test tests/search/search-layout.spec.ts --debug`


## View tests execution result

- run: `npm run show:report`

## Reference guide for writing tests

- https://playwright.dev/docs/pom
- https://ray.run/blog/mastering-poms
